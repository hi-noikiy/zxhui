{template '_header'}<div class="page-header">   当前位置：<span class="text-primary"> 提现申请信息        <small>(申请单号: {$item['applyno']}</small>        <small>商家信息: {$item['realname']} {$item['mobile']})</small></span></div><div class="page-content">    <div class="step-region" >        <ul class="ui-step ui-step-4" >            <li {if $item['status']>=1}class="ui-step-done"{/if}>            <div class="ui-step-number" >1</div>            <div class="ui-step-title" >申请中</div>            <div class="ui-step-meta" >{if 1<=$item['status']}{php echo date('Y-m-d',$item['applytime'])}<br/>{php echo date('H:i:s',$item['applytime'])}{/if}</div>            </li>            <li  {if $item['status']>=2}class="ui-step-done"{/if}>            <div class="ui-step-number">2</div>            <div class="ui-step-title">商家审核</div>            <div class="ui-step-meta">{if 2<=$item['status']}{php echo date('Y-m-d',$item['checktime'])}<br/>{php echo date('H:i:s',$item['checktime'])}{/if}</div>            </li>            <li {if $item['status']>=3}class="ui-step-done"{/if}>            <div class="ui-step-number" >3</div>            <div class="ui-step-title">商家打款</div>            <div class="ui-step-meta" >{if 3<=$item['status']}{php echo date('Y-m-d',$item['paytime'])}<br/>{php echo date('H:i:s',$item['paytime'])}{/if}</div>            </li>            <li {if $item['status']==-1}class="ui-step-done"{/if}>            <div class="ui-step-number" >!</div>            <div class="ui-step-title">无效</div>            <div class="ui-step-meta" >{if -1==$item['status']}{php echo date('Y-m-d',$item['invalidtime'])}<br/>{php echo date('H:i:s',$item['invalidtime'])}{/if}</div>            </li>        </ul>    </div>    {template 'merch/manage/apply/box'}    <form action="./index.php" method="get" class="form-horizontal " role="form" id="form1">        <input type="hidden" name="c" value="site"/>        <input type="hidden" name="a" value="entry"/>        <input type="hidden" name="m" value="ewei_shopv2"/>        <input type="hidden" name="do" value="web"/>        <input type="hidden" name="id" value="{$id}"/>        <input type="hidden" name="status" value="{$status}"/>        <input type="hidden" name="r" value="merch.commissioncheck.detail"/>        <div class="page-toolbar m-b-sm m-t-sm">            {template 'merch/manage/apply/applytype'}            <div class="col-sm-6 pull-right">                <div class="input-group">                    <input type="text" class="form-control input-sm" name="keyword" value="{$_GPC['keyword']}" placeholder="订单编号"/>                 <span class="input-group-btn">                    <button class="btn btn-primary" type="submit"> 搜索</button>                    {ifp 'merch.commissioncheck.detail.export'}                    <button type="submit" name="export" value="1" class="btn btn-success">导出</button>                    {/if}                </span>                </div>            </div>        </div>    </form>    <table class="table table-hover  table-responsive ">        <thead class="navbar-inner">        <tr>            <th style="width:25px;">{if $is_check == 1}<input type='checkbox' class="checkall"/>{/if}</th>            <th style='width:180px;'>订单编号</th>            <!--<th>订单金额</th>-->            <th>可提现金额</th>            <!--<th>抽成比例</th>-->            <th>获得金额</th>            <th>订单完成时间</th>            <th style='width:80px;'>状态</th>        </tr>        </thead>    </table>    <div style="max-height:500px;overflow:auto;border:none; overflow-x:hidden;">        <table class="table table-hover  table-responsive " style="table-layout: fixed;border:none;">            <tbody>            {loop $list $row}            <tr class="orderlist" data="{$row['id']}">                <td style="width:25px;">{if $is_check == 1}<input type='checkbox' {if $row['select']}checked{/if} class="checkitem" value="{$row['id']}"/>{/if}</td>                <td style="width:180px;" data-toggle="tooltip" title="{$row['nickname']}" style="width:80px;">                    {$row['ordersn']}                </td>                <!--<td>{$row['orderprice']}</td>-->                <td >{$row['money']}</td>                <!--<td>{$row['payrate']}%</td>-->                <td>{php echo round($row['money'],2)}</td>                <td>{php echo date('Y-m-d H:i:s',$row['finishtime'])}</td>                <td style='width:80px;cursor: pointer'>{if empty($row['status'])}                    <span class="label label-default">等待</span>                    {elseif $row['status']==1}                    <span class="label label-primary">提交申请</span>                    {elseif $row['status']==-1}                    <span class="label label-danger">拒绝申请</span>                    {elseif $row['status']==2}                    <span class="label label-primary">通过申请</span>                    {elseif $row['status']==3}                    <span class="label label-primary">完成打款</span>                    {/if}                </td>            </tr>            <tr >                <td colspan='6' style="padding: 0">                    <table class='ordertable' style='table-layout:fixed;display: none;' id="orderinfo_{$row['id']}">                        <tr>                            <td style='width:50px'></td>                            <td style='width:110px'>订单商品总额：</td>                            <td style='width:100px'>{$row['goodsprice']}</td>                            <td style='width:110px'>快递金额：</td>                            <td style='width:100px'>{$row['dispatchprice']}</td>                            <td style='width:110px'>订单改价金额</td>                            <td style='width:100px'>{$row['changeprice']}</td>                        </tr>                        <tr>                            <td style='width:50px'></td>                            <td style='width:110px'>积分抵扣金额：</td>                            <td style='width:100px'>{$row['deductprice']}</td>                            <td style='width:110px'>余额抵扣金额：</td>                            <td style='width:100px'>{$row['deductcredit2']}</td>                            <td style='width:110px'>会员折扣金额：</td>                            <td style='width:100px'>{$row['discountprice']}</td>                        </tr>                        <tr>                            <td style='width:50px'></td>                            <td style='width:100px'>总促销金额：</td>                            <td style='width:100px'>{$row['isdiscountprice']}</td>                            <td style='width:110px'>满减金额：</td>                            <td style='width:100px'>{$row['deductenough']}</td>                            <td style='width:110px'>实际支付金额：</td>                            <td style='width:100px'>{$row['price']}</td>                        </tr>                        <tr>                            <td style='width:50px'></td>                            <td style='width:110px'>商户促销金额：</td>                            <td style='width:100px'>{$row['merchisdiscountprice']}</td>                            <td style='width:110px'>商户满减金额：</td>                            <td style='width:100px'>{$row['merchdeductenough']}</td>                            <td style='width:110px'>商户优惠券金额</td>                            <td style='width:100px'>{$row['merchcouponprice']}</td>                        </tr>                        <tr>                            <td style='width:50px'></td>                            <td style='width:110px'>分销佣金：</td>                            <td style='width:100px'>{$row['commission']}</td>                            <td style='width:110px'>秒杀优惠：</td>                            <td style='width:100px'>{$row['seckilldiscountprice']}</td>                            {if $row['refundprice']>0}                            <td style='width:110px'>申请售后剩余金额</td>                            <td style='width:100px'>{$row['refundprice']}</td>                            {else}                            <td style='width:110px'></td>                            <td style='width:100px'></td>                            {/if}                        </tr>                    </table>                </td>            </tr>            {/loop}            <tfoot>            <tr>                <td colspan="6" class="text-right">{$list_pager}</td>            </tr>            </tfoot>            </tbody>        </table>    </div>    <div class="form-group">        <div class="text-left">                {if $item['status']==1}                    {ifp 'merch.commissioncheck.confirm'}                        <input type="button" id="btnconfirm" value="通过申请" class="btn btn-success"/>                    {/if}                    {ifp 'merch.commissioncheck.refuse'}                     <input type="button" id="btnnoconfirm" value="拒绝所有申请" class="btn btn-warning"/>                    {/if}                {/if}            {ifp 'merch.commissioncheck.pay'}                {if $item['status']==2}                    <div class="page-toolbar m-b-sm m-t-sm">                        <div class="col-sm-7" style="width: 320px;">                            <div class="input-group">                                <input type="text" class="form-control input-sm" id="finalprice" name="finalprice" value="{$item['passrealpricerate']}" placeholder="打款金额"/>                                <span class="input-group-btn">                                 {if $item['applytype']==0 || $item['applytype']==2}                                <button class="btn btn-sm btn-danger" id="btnpay" type="button" style="margin-left: 20px;"> 确认打款</button>                                {/if}                                <button class="btn btn-sm btn-warning" id="btnpayhand" type="button" style="margin-left: 20px;">手动处理</button>                                </span>                            </div>                        </div>                    </div>                {/if}            {/if}        </div>    </div></div><script>    window.current = 0;    $(function () {        $('.checkall').click(function () {            var checked = $(this).prop('checked');            $('.checkitem').prop('checked', checked);            if(checked){                change_bill_select(1,-1)            }else{                change_bill_select(0,-1)            }        });        $('#btnnoconfirm').click(function () {            tip.confirm('确认要拒绝所有申请？',function(){                confirm(-1);            });        });        $('#btnconfirm').click(function () {            tip.confirm('通过申请后无法进行修改，确认吗？',function(){                confirm(1);            });        });        $('.checkitem').click(function(){            var checked = $(this).prop('checked');            if(checked){                change_bill_select(1,$(this).val())            }else{                change_bill_select(0,$(this).val())            }        });        $('#btnpay').click(function () {            if ($('#finalprice').isEmpty()) {                tip.msgbox.err('请输入打款金额!');                return;            }            var finalprice = $('#finalprice').val();            var msg = '确认要打款' + finalprice + '元吗？';            tip.confirm(msg,function(){                $('#btnpay').button('loading');                $.ajax({                    url: "{php echo webUrl('merch/commissioncheck/merchpay')}",                    type: 'post',                    dataType: 'json',                    data: {                        id: "{$item['id']}", 'finalprice': finalprice, 'handpay': 0                    },                    success: function (ret) {                        $('#btnpay').button('reset');                        var result = ret.result;                        if (ret.status != 1) {                            tip.msgbox.err(result.message);                            return;                        }                        location.href = biz.url("merch.commissioncheck.status{$status}");                    }                });            });        });        $('#btnpayhand').click(function () {            if ($('#finalprice').isEmpty()) {                tip.msgbox.err('请输入打款金额!');                return;            }            var applytype = $('#applytype').val();            var msg = '手动处理 , 系统不进行任何打款操作!<br/>请确认你已通过线下方式为商户打款!!!<br/>是否进行手动处理?';            var finalprice = $('#finalprice').val();            tip.confirm(msg,function(){                $('#btnpayhand').button('loading');                $.ajax({                    url: "{php echo webUrl('merch/check/merchpay')}",                    type: 'post',                    dataType: 'json',                    data: {                        id: "{$item['id']}", 'finalprice': finalprice, 'handpay': 1                    },                    success: function (ret) {                        $('#btnpayhand').button('reset');                        var result = ret.result;                        if (ret.status != 1) {                            tip.msgbox.err(result.message);                            return;                        }                        location.href = biz.url("merch.commissioncheck.status{$status}");                    }                });            });        });    });    function confirm(type){        if (type == 1) {            $('#btnconfirm').button('loading');        } else {            $('#btnnoconfirm').button('loading');        }        $.ajax({            url: "{php echo webUrl('merch/commissioncheck/confirm')}",            type: 'post',            dataType: 'json',            data: {                id: "{$item['id']}", 'type': type            },            success: function (ret) {                if (type == 1) {                    $('#btnconfirm').button('reset');                } else {                    $('#btnnoconfirm').button('reset');                }                var result = ret.result;                if (ret.status != 1) {                    tip.msgbox.err(result.message);                    return;                }                location.href = biz.url("merch.commissioncheck.status{$status}");            }        });    }    function change_bill_select(type,bpid){        $('#btnconfirm').button('loading');        $('#btnnoconfirm').button('loading');        $.ajax({            url: "{php echo webUrl('merch/commissioncheck/change_bill_select')}",            type: 'post',            dataType: 'json',            data: {                id: "{$item['id']}", 'type': type, 'bpid': bpid            },            success: function (ret) {                $('#btnconfirm').button('reset');                $('#btnnoconfirm').button('reset');            }        });    }</script>{template '_footer'}